<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#6c4df5" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>üì¶ Estoque Headset (PWA)</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <style>
    :root{ --bg:#f7f7ff; --ring:#7c6cf7; --ink:#0e1133; }
    *{ box-sizing:border-box }
    html,body{ height:100%; margin:0; }
    body{
      background:radial-gradient(1200px 600px at 10% -10%, rgba(124,108,247,.12), transparent 50%) no-repeat, #fff;
      color:var(--ink); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; 
    }
    .wrap{ height:100%; display:flex; flex-direction:column; }
    header{
      padding:14px 16px; display:flex; align-items:center; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px;
    }
    .dot{
      width:28px; height:28px; border-radius:10px;
      background: linear-gradient(135deg, #ff58b0, #7c6cf7);
      box-shadow: 0 6px 24px rgba(124,108,247,.35);
    }
    .t{ font-size:18px }
    .hint{ margin-left:auto; font-size:12px; color:#667; opacity:.9 }
    .frame{
      position:relative; flex:1; min-height:0; margin:0 12px 12px; border-radius:16px; overflow:hidden;
      border:1px solid rgba(124,108,247,.15); box-shadow: 0 14px 42px rgba(124,108,247,.12);
      background:#fff;
    }
    iframe{ width:100%; height:100%; border:0; display:block; background:#fff; }

    /* fallback quando iframe n√£o carrega */
    .fallback{
      position:absolute; inset:0; display:none; align-items:center; justify-content:center; flex-direction:column; gap:14px;
      background:linear-gradient(180deg,#fff, #fbfbff);
    }
    .fallback.show{ display:flex; }
    .msg{ font-size:15px; color:#445; }
    .btn{
      padding:10px 16px; border-radius:12px; border:2px solid var(--ring); background:#fff; color:var(--ring);
      font-weight:700; cursor:pointer;
      box-shadow: 0 8px 28px rgba(124,108,247,.18);
    }
    footer{ padding:10px 14px; text-align:center; font-size:12px; color:#7a7fa8; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="dot"></div>
        <div class="t">Estoque Headset</div>
      </div>
      <div class="hint">PWA ‚Äî instalar pela op√ß√£o ‚ÄúAdicionar √† tela inicial‚Äù.</div>
    </header>

    <div class="frame">
      <iframe id="app" 
              src="https://script.google.com/macros/s/AKfycbxMtY3P5egk0xHFVEV5CyzxkbtLtfHF4pVdd7yTLGsCQbOlnS5B6XNHJbcmjaJ7Lsff0A/exec"
              referrerpolicy="no-referrer" loading="eager" allow="clipboard-write">
      </iframe>

      <div id="fallback" class="fallback">
        <div class="msg">N√£o foi poss√≠vel carregar o app embutido.</div>
        <button class="btn" id="openNew">Abrir em nova aba</button>
      </div>
    </div>

    <footer>¬© HD TECH</footer>
  </div>

  <script>
    // Service Worker para PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
    }

    // Fallback caso o iframe n√£o carregue (bloqueio de rede, etc.)
    const IFRAME_URL = 'https://script.google.com/macros/s/AKfycbxMtY3P5egk0xHFVEV5CyzxkbtLtfHF4pVdd7yTLGsCQbOlnS5B6XNHJbcmjaJ7Lsff0A/exec';
    const frame = document.getElementById('app');
    const fallback = document.getElementById('fallback');
    const btn = document.getElementById('openNew');
    let loaded = false;

    frame.addEventListener('load', ()=>{ loaded = true; });
    setTimeout(()=>{ if(!loaded){ fallback.classList.add('show'); } }, 4000);
    btn.addEventListener('click', ()=>{ window.open(IFRAME_URL, '_blank'); });
  </script>
</body>
</html>
